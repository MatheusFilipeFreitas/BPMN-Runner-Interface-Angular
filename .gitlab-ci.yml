stages:
  - build
  - deploy

variables:
  API_TOKEN: $AZURE_DEPLOYMENT_TOKEN
  OUTPUT_LOCATION: "dist/bpmn-runner-doc-page/"

build_job:
  stage: build
  image: node:22.18-alpine
  script:
    - npm install
    - npm run build --prod
  artifacts:
    paths:
      - dist/
    expire_in: 1h
 
deploy_job:
  stage: deploy
  image: registry.gitlab.com/static-web-apps/azure-static-web-apps-deploy
  dependencies:
    - build_job
  variables:
    AZURE_STATIC_WEB_APPS_API_TOKEN: $API_TOKEN
    APP_LOCATION: "/"
    OUTPUT_LOCATION: "dist/bpmn-runner-doc-page/"
  script:
    - export API_TOKEN="$AZURE_DEPLOYMENT_TOKEN"
    - export APP_PATH="$APP_LOCATION"
    - export OUTPUT_PATH="$OUTPUT_LOCATION"
    - /bin/entrypoint.sh
  only:
    - main